<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cache Nuke (reset)</title>
  <style>
    body{ font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif; padding:18px; }
    code{ background:#eee; padding:2px 6px; border-radius:6px; }
    .ok{ color:#0a7; }
    .ng{ color:#a00; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>Cache Nuke (reset)</h1>
  <p>Service Worker の解除と Cache Storage を削除します（黒画面の典型原因）。</p>
  <p id="log">実行中…</p>
  <script>
    (async () => {
      const log = document.getElementById('log');
      function add(cls, t){
        const p=document.createElement('p'); p.className=cls; p.textContent=t; document.body.appendChild(p);
      }
      try{
        if ('serviceWorker' in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) await r.unregister();
          add('ok', 'Service Worker: unregistered ('+regs.length+')');
        } else {
          add('ok', 'Service Worker: not supported');
        }
        if ('caches' in window){
          const keys = await caches.keys();
          await Promise.all(keys.map(k => caches.delete(k)));
          add('ok', 'Cache Storage: deleted ('+keys.length+')');
        } else {
          add('ok', 'Cache Storage: not supported');
        }
        log.textContent = '完了。3秒後に index.html を再読込します。';
        setTimeout(() => location.href = './?cb=' + Date.now(), 3000);
      }catch(e){
        log.textContent = '失敗。下のエラーを貼ってください。';
        add('ng', String(e && e.stack ? e.stack : e));
      }
    })();
  </script>
</body>
</html>
